<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <title>Fotbollscuper 2026 ‚Äì P11:2</title>
  <style>
    html, body {
      height: 100%;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
      min-height: 100%;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 16px;
      overflow: hidden;
    }
    .page-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 16px;
    }
    h1 {
      margin-bottom: 0;
    }
    #cupCounter {
      align-self: center;
      padding: 10px 18px;
      border-radius: 999px;
      background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
      color: #ffffff;
      font-weight: 700;
      font-size: 18px;
      letter-spacing: 0.04em;
      box-shadow: 0 12px 24px rgba(37, 99, 235, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.35);
      min-width: 180px;
      text-align: center;
    }
    small {
      color: #555;
    }
    .note {
      font-size: 12px;
      color: #666;
      margin-top: 8px;
      max-width: 900px;
    }
    .hidden {
      display: none;
    }
    a {
      color: #0b66c3;
    }
    .cup-link {
      text-decoration: none;
    }
    .cup-link:hover {
      text-decoration: underline;
    }
    .filters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      padding: 16px;
      background: #ffffff;
      border-radius: 12px;
      margin: 16px 0;
      box-shadow: 0 12px 32px rgba(15, 23, 42, 0.08);
      position: sticky;
      top: 0;
      z-index: 100;
      border: 1px solid rgba(148, 163, 184, 0.25);
      align-items: flex-start;
    }
    .filters-section {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .filters-toggle-btn {
      align-self: flex-start;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(99, 102, 241, 0.35);
      background: #eef2ff;
      color: #1e3a8a;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
    }
    .filters-toggle-btn:hover {
      background: #e0e7ff;
      transform: translateY(-1px);
    }
    .filters.collapsed {
      display: none;
    }
    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 14px;
      border-radius: 12px;
      background: linear-gradient(180deg, #f9fbff 0%, #f1f4fb 100%);
      border: 1px solid rgba(99, 102, 241, 0.12);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.9);
    }
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 16px;
      min-height: 0;
    }
    .filter-group--wide {
      grid-column: 1 / -1;
    }
    .filter-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .filter-title {
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: #334155;
    }
    .filter-control {
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #cbd5f0;
      font-size: 14px;
      background: #ffffff;
      box-shadow: 0 1px 2px rgba(15, 23, 42, 0.08);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      width: 100%;
    }
    .filter-control:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
    }
    .month-filter,
    .country-filter {
      gap: 12px;
    }
    .month-options,
    .country-options,
    .level-options,
    .cost-options {
      display: grid;
      gap: 6px 12px;
      padding: 12px;
      border-radius: 10px;
      background: #ffffff;
      border: 1px dashed rgba(99, 102, 241, 0.25);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.7);
    }
    .month-options {
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
    }
    .country-options {
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    }
    .level-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      align-items: stretch;
    }
    .cost-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 10px;
      align-items: stretch;
    }
    .month-option,
    .country-option,
    .level-option,
    .cost-option {
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
      color: #1f2937;
    }
    .level-option,
    .cost-option {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: none;
      background: transparent;
      box-shadow: none;
      justify-content: flex-start;
      transition: background 0.2s ease;
    }
    .level-option:hover,
    .cost-option:hover {
      background: rgba(99, 102, 241, 0.12);
    }
    .country-flag {
      font-size: 18px;
      line-height: 1;
    }
    .option-emoji {
      font-size: 18px;
      line-height: 1;
    }
    .filter-group input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: #2563eb;
      flex-shrink: 0;
    }
    .clear-month-btn,
    .clear-country-btn {
      padding: 6px 12px;
      font-size: 12px;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      color: #1e3a8a;
      background: #eef2ff;
      border: 1px solid rgba(99, 102, 241, 0.35);
      border-radius: 999px;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
    }
    .clear-month-btn:hover,
    .clear-country-btn:hover {
      background: #e0e7ff;
      transform: translateY(-1px);
    }
    .planning-card {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 16px;
      margin-bottom: 16px;
      border-radius: 12px;
      background: #ffffff;
      border: 1px solid rgba(148, 163, 184, 0.25);
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
    }
    .planning-inputs {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    .planning-label {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      color: #334155;
    }
    .planning-control {
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #cbd5f0;
      font-size: 14px;
      width: 140px;
      box-shadow: 0 1px 2px rgba(15, 23, 42, 0.08);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .planning-control:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
    }
    .planning-total {
      flex: 1 1 260px;
      min-width: 260px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      color: #1f2937;
    }
    .planning-total-line {
      display: grid;
      grid-template-columns: max-content auto;
      align-items: baseline;
      justify-content: end;
      column-gap: 6px;
      font-size: 14px;
    }
    .planning-total-label {
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: #475569;
      text-align: right;
    }
    .planning-total-label::after {
      content: ':';
      margin-left: 4px;
    }
    .planning-total-value {
      font-size: 15px;
      font-weight: 600;
      color: #1e3a8a;
    }
    .planning-total-line--total .planning-total-label {
      font-size: 12px;
      color: #1e3a8a;
    }
    .planning-total-line--total .planning-total-value {
      font-size: 18px;
      font-weight: 700;
    }
    .table-scroll {
      flex: 1;
      min-height: 0;
      overflow-y: auto;
      position: relative;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #ffffff;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 8px 10px;
      border-bottom: 1px solid #eee;
      font-size: 13px;
      vertical-align: top;
    }
    th {
      background: #fafafa;
      position: sticky;
      top: 0px;
      z-index: 102;
    }
    th.sortable {
      cursor: pointer;
      user-select: none;
    }
    th.sortable::after {
      content: " ‚áÖ";
      font-size: 11px;
      color: #888;
    }
    th.sorted-asc::after {
      content: " ‚Üë";
      font-size: 11px;
      color: #000;
    }
    th.sorted-desc::after {
      content: " ‚Üì";
      font-size: 11px;
      color: #000;
    }
    tr:nth-child(even) td {
      background: #fcfcfc;
    }
    .level-tag {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      background: #eef;
    }
    .level-elite { background: #ffe5e5; }
    .level-bredd { background: #e5ffe8; }
    .level-mix   { background: #fff7e0; }
    .note {
      font-size: 12px;
      color: #666;
      margin-top: 8px;
      max-width: 900px;
    }
    .hidden {
      display: none;
    }
    a {
      color: #0b66c3;
    }
  </style>
</head>
<body>
  <div class="page-header">
    <h1>Fotbollscuper 2026 ‚Äì P11:2</h1>
    <div class="cup-count" id="cupCounter"></div>
  </div>
  <div class="main-content">
    <div class="filters-section">
      <button type="button" id="toggleFiltersBtn" class="filters-toggle-btn" aria-expanded="true" aria-controls="filtersPanel">D√∂lj filter</button>
      <div class="filters" id="filtersPanel">
      <div class="filter-group filter-group--wide month-filter">
        <div class="filter-header">
          <span class="filter-title">M√•nad(er)</span>
          <button type="button" id="clearMonthFilter" class="clear-month-btn">Rensa val</button>
        </div>
        <div class="month-options">
          <label class="month-option"><input type="checkbox" class="month-checkbox" value="1" /> Jan</label>
          <label class="month-option"><input type="checkbox" class="month-checkbox" value="2" /> Feb</label>
          <label class="month-option"><input type="checkbox" class="month-checkbox" value="3" /> Mar</label>
          <label class="month-option"><input type="checkbox" class="month-checkbox" value="4" /> Apr</label>
          <label class="month-option"><input type="checkbox" class="month-checkbox" value="5" /> Maj</label>
          <label class="month-option"><input type="checkbox" class="month-checkbox" value="6" /> Jun</label>
          <label class="month-option"><input type="checkbox" class="month-checkbox" value="7" /> Jul</label>
          <label class="month-option"><input type="checkbox" class="month-checkbox" value="8" /> Aug</label>
          <label class="month-option"><input type="checkbox" class="month-checkbox" value="9" /> Sep</label>
          <label class="month-option"><input type="checkbox" class="month-checkbox" value="10" /> Okt</label>
          <label class="month-option"><input type="checkbox" class="month-checkbox" value="11" /> Nov</label>
          <label class="month-option"><input type="checkbox" class="month-checkbox" value="12" /> Dec</label>
        </div>
      </div>
      <div class="filter-group filter-group--wide country-filter">
        <div class="filter-header">
          <span class="filter-title">Land</span>
          <button type="button" id="clearCountryFilter" class="clear-country-btn">Rensa val</button>
        </div>
        <div class="country-options">
          <label class="country-option"><input type="checkbox" class="country-checkbox" value="Sverige" /> <span class="country-flag">üá∏üá™</span><span>Sverige</span></label>
          <label class="country-option"><input type="checkbox" class="country-checkbox" value="Norge" /> <span class="country-flag">üá≥üá¥</span><span>Norge</span></label>
          <label class="country-option"><input type="checkbox" class="country-checkbox" value="Finland" /> <span class="country-flag">üá´üáÆ</span><span>Finland</span></label>
          <label class="country-option"><input type="checkbox" class="country-checkbox" value="Danmark" /> <span class="country-flag">üá©üá∞</span><span>Danmark</span></label>
          <label class="country-option"><input type="checkbox" class="country-checkbox" value="Spanien" /> <span class="country-flag">üá™üá∏</span><span>Spanien</span></label>
          <label class="country-option"><input type="checkbox" class="country-checkbox" value="Frankrike" /> <span class="country-flag">üá´üá∑</span><span>Frankrike</span></label>
          <label class="country-option"><input type="checkbox" class="country-checkbox" value="Nederl√§nderna" /> <span class="country-flag">üá≥üá±</span><span>Nederl√§nderna</span></label>
          <label class="country-option"><input type="checkbox" class="country-checkbox" value="Lettland" /> <span class="country-flag">üá±üáª</span><span>Lettland</span></label>
          <label class="country-option"><input type="checkbox" class="country-checkbox" value="Belgien" /> <span class="country-flag">üáßüá™</span><span>Belgien</span></label>
          <label class="country-option"><input type="checkbox" class="country-checkbox" value="Italien" /> <span class="country-flag">üáÆüáπ</span><span>Italien</span></label>
          <label class="country-option"><input type="checkbox" class="country-checkbox" value="Portugal" /> <span class="country-flag">üáµüáπ</span><span>Portugal</span></label>
        </div>
      </div>
      <div class="filter-group filter-group--wide level-filter">
        <div class="filter-header">
          <span class="filter-title">Niv√•</span>
          <button type="button" id="clearLevelFilter" class="clear-country-btn">Rensa val</button>
        </div>
        <div class="level-options">
          <label class="level-option"><input type="checkbox" class="level-checkbox" value="elite" /> <span class="option-emoji" aria-hidden="true">üèÜ</span><span>Elite</span></label>
          <label class="level-option"><input type="checkbox" class="level-checkbox" value="bredd" /> <span class="option-emoji" aria-hidden="true">ü§ù</span><span>Bredd</span></label>
          <label class="level-option"><input type="checkbox" class="level-checkbox" value="mix" /> <span class="option-emoji" aria-hidden="true">üîÑ</span><span>Mix</span></label>
        </div>
      </div>
      <div class="filter-group filter-group--wide cost-filter">
        <div class="filter-header">
          <span class="filter-title">Priser</span>
          <button type="button" id="clearCostFilter" class="clear-country-btn">Rensa val</button>
        </div>
        <div class="cost-options">
          <label class="cost-option"><input type="checkbox" class="cost-checkbox" value="with" /> <span class="option-emoji" aria-hidden="true">üí∞</span><span>Har priser</span></label>
          <label class="cost-option"><input type="checkbox" class="cost-checkbox" value="without" /> <span class="option-emoji" aria-hidden="true">üö´üí∞</span><span>Saknar priser</span></label>
        </div>
      </div>
      </div>
    </div>
    <div class="planning-card">
      <div class="planning-inputs">
        <label for="numPlayers" class="planning-label">
          Antal spelare
          <input type="number" id="numPlayers" class="planning-control" min="0" value="20" />
        </label>
        <label for="numCoaches" class="planning-label">
          Antal ledare
          <input type="number" id="numCoaches" class="planning-control" min="0" value="4" />
        </label>
      </div>
      <div class="planning-total">
        <div class="planning-total-line">
          <span class="planning-total-label">Pris per spelare</span>
          <span class="planning-total-value" id="playerCostDisplay">‚Äì</span>
        </div>
        <div class="planning-total-line">
          <span class="planning-total-label">Pris per ledare</span>
          <span class="planning-total-value" id="leaderCostDisplay">‚Äì</span>
        </div>
        <div class="planning-total-line">
          <span class="planning-total-label">Pris f√∂r lag</span>
          <span class="planning-total-value" id="teamCostDisplay">‚Äì</span>
        </div>
        <div class="planning-total-line planning-total-line--total">
          <span class="planning-total-label">Total kostnad</span>
          <span class="planning-total-value" id="totalCostDisplay">‚Äì</span>
        </div>
      </div>
    </div>
    <div class="table-scroll">
      <table>
        <thead>
        <tr>
          <th></th>
          <th data-sort-key="name" class="sortable">Cup</th>
          <th data-sort-key="startDate" class="sortable">Datum</th>
          <th data-sort-key="monthSortValue" class="sortable hidden">M√•nader</th>
          <th data-sort-key="country" class="sortable">Land</th>
          <th data-sort-key="city" class="sortable">Stad</th>
          <th data-sort-key="level" class="sortable">Niv√•</th>
          <th data-sort-key="registrationDeadline" class="sortable">Sista anm√§lan</th>
          <th data-sort-key="playerCostText" class="sortable">Spelarkostnad info</th>
          <th data-sort-key="playerCostEurApprox" class="sortable">Spelarkostnad (SEK)</th>
          <th data-sort-key="leaderCostText" class="sortable">Ledarkostnad info</th>
          <th data-sort-key="leaderCostEurApprox" class="sortable">Ledarkostnad (SEK)</th>
          <th data-sort-key="teamFeeText" class="sortable">Lagkostnad info</th>
          <th data-sort-key="teamFeeEurApprox" class="sortable">Lagkostnad (SEK)</th>
          <th data-sort-key="accommodation" class="sortable">Boende</th>
        </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
      <p class="note">
        * Sista anm√§lningsdatum och kostnader √§ndras ofta √•r till √•r och var inte
        alltid publicerade f√∂r 2026 n√§r denna fil skapades. Anv√§nd tabellen som
        utg√•ngspunkt och dubbelkolla alltid p√• cupens officiella webbsida eller hos
        din researrang√∂r innan ni best√§mmer er eller g√∂r budget.
      </p>
    </div>
  </div>
  <script>
      const monthNames = [
          'januari',
          'februari',
          'mars',
          'april',
          'maj',
          'juni',
          'juli',
          'augusti',
          'september',
          'oktober',
          'november',
          'december',
        ];

        const currencyFormatter = new Intl.NumberFormat('sv-SE', {
          style: 'currency',
          currency: 'SEK',
          maximumFractionDigits: 0,
        });

        function formatCurrency(value) {
          return typeof value === 'number' && !Number.isNaN(value)
            ? currencyFormatter.format(value)
            : '‚Äì';
        }

        function updateTotalCostDisplay() {
          const checkboxes = document.querySelectorAll('.cup-select');
          const selectedIndexes = Array.from(checkboxes)
            .filter(cb => cb.checked)
            .map(cb => parseInt(cb.getAttribute('data-index'), 10));
          const selectedCups = selectedIndexes.map(idx => currentCups[idx]).filter(Boolean);
          const numPlayers = parseInt(document.getElementById('numPlayers').value, 10) || 0;
          const numCoaches = parseInt(document.getElementById('numCoaches').value, 10) || 0;
          const playerCostDisplay = document.getElementById('playerCostDisplay');
          const leaderCostDisplay = document.getElementById('leaderCostDisplay');
          const teamCostDisplay = document.getElementById('teamCostDisplay');
          const totalCostDisplay = document.getElementById('totalCostDisplay');

          if (!playerCostDisplay || !leaderCostDisplay || !teamCostDisplay || !totalCostDisplay) {
            return;
          }

          if (selectedCups.length === 0) {
            playerCostDisplay.textContent = '‚Äì';
            leaderCostDisplay.textContent = '‚Äì';
            teamCostDisplay.textContent = '‚Äì';
            totalCostDisplay.textContent = '‚Äì';
            return;
          }

          const hasPlayerCostData = selectedCups.some(cup => hasNumericCost(cup.playerCostEurApprox));
          const hasLeaderCostData = selectedCups.some(cup => hasNumericCost(cup.leaderCostEurApprox));
          const hasTeamCostData = selectedCups.some(cup => hasNumericCost(cup.teamFeeEurApprox));

          const totalPlayerCost = hasPlayerCostData
            ? selectedCups.reduce((sum, cup) => {
                const cost = hasNumericCost(cup.playerCostEurApprox) ? cup.playerCostEurApprox : 0;
                return sum + (numPlayers * cost);
              }, 0)
            : 0;

          const totalLeaderCost = hasLeaderCostData
            ? selectedCups.reduce((sum, cup) => {
                const cost = hasNumericCost(cup.leaderCostEurApprox) ? cup.leaderCostEurApprox : 0;
                return sum + (numCoaches * cost);
              }, 0)
            : 0;

          const totalTeamCost = hasTeamCostData
            ? selectedCups.reduce((sum, cup) => {
                const cost = hasNumericCost(cup.teamFeeEurApprox) ? cup.teamFeeEurApprox : 0;
                return sum + cost;
              }, 0)
            : 0;

          const hasAnyCostData = hasPlayerCostData || hasLeaderCostData || hasTeamCostData;
          const totalCost = totalPlayerCost + totalLeaderCost + totalTeamCost;

          playerCostDisplay.textContent = hasPlayerCostData ? formatCurrency(totalPlayerCost) : '‚Äì';
          leaderCostDisplay.textContent = hasLeaderCostData ? formatCurrency(totalLeaderCost) : '‚Äì';
          teamCostDisplay.textContent = hasTeamCostData ? formatCurrency(totalTeamCost) : '‚Äì';
          totalCostDisplay.textContent = hasAnyCostData ? formatCurrency(totalCost) : '‚Äì';
        }
    // Globala variabler och DOM-element
    let cups = [];
    let currentCups = [];
    const filtersPanel = document.getElementById('filtersPanel');
    const toggleFiltersBtn = document.getElementById('toggleFiltersBtn');
    const monthCheckboxes = Array.from(document.querySelectorAll('.month-checkbox'));
    const clearMonthFilterBtn = document.getElementById('clearMonthFilter');
    const countryCheckboxes = Array.from(document.querySelectorAll('.country-checkbox'));
    const clearCountryFilterBtn = document.getElementById('clearCountryFilter');
    const levelCheckboxes = Array.from(document.querySelectorAll('.level-checkbox'));
    const costCheckboxes = Array.from(document.querySelectorAll('.cost-checkbox'));
    const clearLevelFilterBtn = document.getElementById('clearLevelFilter');
    const clearCostFilterBtn = document.getElementById('clearCostFilter');
    const headerCells = Array.from(document.querySelectorAll('th.sortable'));
    const tableBody = document.getElementById('tableBody');

    let currentSort = {
      key: "startDate",
      direction: "asc", // eller "desc"
    };

    function updateCupCount(count) {
      const el = document.getElementById("cupCounter");
      if (el) {
        el.textContent = `Antal cuper: ${count}`;
      }
    }

    function normalize(str) {
      return (str || "").toLowerCase().trim();
    }

    function parseDate(value) {
      if (!value) return null;
      const d = new Date(value);
      return isNaN(d.getTime()) ? null : d;
    }

    function extractMonthIndices(cup) {
      const months = new Set();
      const start = parseDate(cup.startDate);
      const end = parseDate(cup.endDate);

      if (start && end) {
        const current = new Date(start.getFullYear(), start.getMonth(), 1);
        const limit = new Date(end.getFullYear(), end.getMonth(), 1);
        while (current <= limit) {
          months.add(current.getMonth());
          current.setMonth(current.getMonth() + 1);
        }
      } else if (start || end) {
        const single = start || end;
        months.add(single.getMonth());
      } else if (typeof cup.month === 'number') {
        const idx = Math.max(0, Math.min(11, cup.month - 1));
        months.add(idx);
      }

      return Array.from(months).sort((a, b) => a - b);
    }

    function enrichCupWithMonths(cup) {
      const monthIndices = extractMonthIndices(cup);
      cup.monthsDisplay = monthIndices.length
        ? monthIndices.map(idx => monthNames[idx]).join(', ')
        : '';
      cup.monthSortValue = monthIndices.length ? monthIndices[0] : Infinity;
      cup.monthIndices = monthIndices;
    }

    function hasNumericCost(value) {
      return typeof value === "number" && !Number.isNaN(value);
    }

    function cupHasAnyCost(cup) {
      return (
        hasNumericCost(cup.playerCostEurApprox) ||
        hasNumericCost(cup.leaderCostEurApprox) ||
        hasNumericCost(cup.teamFeeEurApprox)
      );
    }

    function applyFilters(cupsArray) {
      const monthFilterIndices = monthCheckboxes
        .filter(cb => cb.checked)
        .map(cb => parseInt(cb.value, 10) - 1)
        .filter(idx => idx >= 0 && idx < 12);
      const selectedCountries = countryCheckboxes
        .filter(cb => cb.checked)
        .map(cb => cb.value);
      const selectedLevels = levelCheckboxes
        .filter(cb => cb.checked)
        .map(cb => cb.value);
      const selectedCostModes = costCheckboxes
        .filter(cb => cb.checked)
        .map(cb => cb.value);

      return cupsArray.filter(cup => {
        if (monthFilterIndices.length > 0) {
          const indices = Array.isArray(cup.monthIndices) ? cup.monthIndices : [];
          const matches = monthFilterIndices.some(idx => indices.includes(idx));
          if (!matches) return false;
        }
        if (selectedCountries.length > 0 && !selectedCountries.includes(cup.country)) return false;
        if (selectedLevels.length > 0 && !selectedLevels.includes(cup.level)) return false;

        if (selectedCostModes.length > 0) {
          const hasCost = cupHasAnyCost(cup);
          const costMatches = selectedCostModes.some(mode =>
            (mode === "with" && hasCost) || (mode === "without" && !hasCost)
          );
          if (!costMatches) return false;
        }

        return true;
      });
    }

    function compareValues(a, b, key) {
      const va = a[key];
      const vb = b[key];

      // datum
      if (key === "startDate" || key === "registrationDeadline") {
        const da = parseDate(va);
        const db = parseDate(vb);
        if (!da && !db) return 0;
        if (!da) return 1;
        if (!db) return -1;
        return da - db;
      }

      // tal
      if (typeof va === "number" || typeof vb === "number") {
        const na = typeof va === "number" ? va : Infinity;
        const nb = typeof vb === "number" ? vb : Infinity;
        if (na === nb) return 0;
        return na < nb ? -1 : 1;
      }

      // str√§ng
      const sa = normalize(String(va || ""));
      const sb = normalize(String(vb || ""));
      if (sa === sb) return 0;
      return sa < sb ? -1 : 1;
    }

    function sortCups(cupsArray) {
      const sorted = [...cupsArray].sort((a, b) => {
        const cmp = compareValues(a, b, currentSort.key);
        return currentSort.direction === "asc" ? cmp : -cmp;
      });
      return sorted;
    }

    function levelClass(level) {
      if (level === "elite") return "level-elite";
      if (level === "bredd") return "level-bredd";
      if (level === "mix") return "level-mix";
      return "";
    }

    function renderTable() {
      const filtered = applyFilters(cups);
        const sorted = sortCups(filtered);
      currentCups = sorted;

      tableBody.innerHTML = "";

      sorted.forEach((cup, idx) => {
        if (typeof cup.monthsDisplay === 'undefined') {
          enrichCupWithMonths(cup);
        }
        const tr = document.createElement("tr");
        const cupNameCell = cup.url
          ? `<a href="${cup.url}" target="_blank" rel="noopener" class="cup-link"><strong>${cup.name}</strong></a>`
          : `<strong>${cup.name}</strong>`;

        tr.innerHTML = `
          <td><input type="checkbox" class="cup-select" data-index="${idx}" /></td>
          <td>${cupNameCell}</td>
          <td>${cup.dateText || ""}</td>
          <td class="hidden">${cup.monthsDisplay || ""}</td>
          <td>${getCountryFlag(cup.country)} ${cup.country || ""}</td>
          <td>${cup.city || ""}</td>
          <td>
            ${
              cup.level
                ? `<span class=\"level-tag ${levelClass(cup.level)}\">${cup.levelDisplay || ""}</span>`
                : ""
            }
          </td>
          <td>${cup.registrationDeadlineText || ""}</td>
          <td>${cup.playerCostText || ""}</td>
          <td>${formatCurrency(cup.playerCostEurApprox)}</td>
          <td>${cup.leaderCostText || ""}</td>
          <td>${formatCurrency(cup.leaderCostEurApprox)}</td>
          <td>${cup.teamFeeText || ""}</td>
          <td>${formatCurrency(cup.teamFeeEurApprox)}</td>
          <td>${cup.accommodation || ""}</td>
        `;
        tableBody.appendChild(tr);
      });
      updateCupCount(sorted.length);
      // Add event listeners for checkboxes
      setTimeout(() => {
        document.querySelectorAll('.cup-select').forEach(cb => {
          cb.addEventListener('change', updateTotalCostDisplay);
        });
        updateTotalCostDisplay();
      }, 0);
      // Update the counter to show the filtered count
      updateCupCount(sorted.length);
      // update counter to show filtered count
      updateCupCount(sorted.length);
    }

    function setHeaderSortStyles() {
      headerCells.forEach(th => {
        th.classList.remove("sorted-asc", "sorted-desc");
        const key = th.getAttribute("data-sort-key");
        if (key === currentSort.key) {
          th.classList.add(currentSort.direction === "asc" ? "sorted-asc" : "sorted-desc");
        }
      });
    }

    function initSorting() {
      headerCells.forEach(th => {
        th.addEventListener("click", () => {
          const key = th.getAttribute("data-sort-key");
          if (!key) return;

          if (currentSort.key === key) {
            currentSort.direction = currentSort.direction === "asc" ? "desc" : "asc";
          } else {
            currentSort.key = key;
            currentSort.direction = "asc";
          }

          setHeaderSortStyles();
          renderTable();
        });
      });
      setHeaderSortStyles();
    }

    function initFilterToggle() {
      if (!filtersPanel || !toggleFiltersBtn) return;
      toggleFiltersBtn.addEventListener('click', () => {
        const isCollapsed = filtersPanel.classList.toggle('collapsed');
        toggleFiltersBtn.setAttribute('aria-expanded', (!isCollapsed).toString());
        toggleFiltersBtn.textContent = isCollapsed ? 'Visa filter' : 'D√∂lj filter';
      });
    }

    function initFilters() {
      monthCheckboxes.forEach(cb => {
        cb.addEventListener('change', () => {
          renderTable();
          updateTotalCostDisplay();
        });
      });
      countryCheckboxes.forEach(cb => {
        cb.addEventListener('change', () => {
          renderTable();
          updateTotalCostDisplay();
        });
      });
      levelCheckboxes.forEach(cb => {
        cb.addEventListener('change', () => {
          renderTable();
          updateTotalCostDisplay();
        });
      });
      costCheckboxes.forEach(cb => {
        cb.addEventListener('change', () => {
          renderTable();
          updateTotalCostDisplay();
        });
      });
      if (clearMonthFilterBtn) {
        clearMonthFilterBtn.addEventListener('click', () => {
          monthCheckboxes.forEach(cb => {
            cb.checked = false;
          });
          renderTable();
          updateTotalCostDisplay();
        });
      }
      if (clearCountryFilterBtn) {
        clearCountryFilterBtn.addEventListener('click', () => {
          countryCheckboxes.forEach(cb => {
            cb.checked = false;
          });
          renderTable();
          updateTotalCostDisplay();
        });
      }
      if (clearLevelFilterBtn) {
        clearLevelFilterBtn.addEventListener('click', () => {
          levelCheckboxes.forEach(cb => {
            cb.checked = false;
          });
          renderTable();
          updateTotalCostDisplay();
        });
      }
      if (clearCostFilterBtn) {
        clearCostFilterBtn.addEventListener('click', () => {
          costCheckboxes.forEach(cb => {
            cb.checked = false;
          });
          renderTable();
          updateTotalCostDisplay();
        });
      }
      document.getElementById('numPlayers').addEventListener('input', updateTotalCostDisplay);
      document.getElementById('numCoaches').addEventListener('input', updateTotalCostDisplay);
    }

    async function loadData() {
      try {
        const response = await fetch("cuper_2026_data.json");
        cups = await response.json();
        cups.forEach(enrichCupWithMonths);
        updateCupCount(cups.length); // Show total on load
        renderTable();
      } catch (err) {
        console.error("Kunde inte ladda JSON-data:", err);
        tableBody.innerHTML = `
          <tr>
            <td colspan="15" style="color:red;">
              Kunde inte ladda cuper fr√•n <code>cuper_2026_data_cleaned.json</code>. Kontrollera filnamn och s√∂kv√§g.
            </td>
          </tr>
        `;
      }
    }

    // Helper to get country flag emoji or image
    function getCountryFlag(country) {
      if (!country) return "";
      const flags = {
        "Sverige": "üá∏üá™",
        "Norge": "üá≥üá¥",
        "Finland": "üá´üáÆ",
        "Danmark": "üá©üá∞",
        "Spanien": "üá™üá∏",
        "Frankrike": "üá´üá∑",
        "Nederl√§nderna": "üá≥üá±",
        "Lettland": "üá±üáª",
        "Belgien": "üáßüá™",
        "Italien": "üáÆüáπ",
        "Portugal": "üáµüáπ"
      };
      return flags[country] || "";
    }

    initSorting();
    initFilterToggle();
    initFilters();
    loadData();
  </script>
</body>
</html>
