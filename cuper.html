<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <title>Fotbollscuper 2026 â€“ P11:2</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 20px;
      background: #f5f5f5;
      min-height: 100vh;
    }
    h1 {
      margin-bottom: 0;
    }
    small {
      color: #555;
    }
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      padding: 12px;
      background: #ffffff;
      border-radius: 8px;
      margin-bottom: 0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .filters label {
      font-size: 14px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .filters select,
    .filters input {
      padding: 4px 6px;
      font-size: 14px;
    }
    .table-scroll {
      position: relative;
      margin-top: 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #ffffff;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 12px 10px;
      border-bottom: 1px solid #eee;
      font-size: 13px;
      vertical-align: top;
    }
    th {
      background: #fafafa;
      position: sticky;
      top: 0px;
      z-index: 10;
    }
    th.sortable {
      cursor: pointer;
      user-select: none;
    }
    th.sortable::after {
      content: " â‡…";
      font-size: 11px;
      color: #888;
    }
    th.sorted-asc::after {
      content: " â†‘";
      font-size: 11px;
      color: #000;
    }
    th.sorted-desc::after {
      content: " â†“";
      font-size: 11px;
      color: #000;
    }
    tr:nth-child(even) td {
      background: #fcfcfc;
    }
    .level-tag {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      background: #eef;
    }
    .level-elite { background: #ffe5e5; }
    .level-bredd { background: #e5ffe8; }
    .level-mix   { background: #fff7e0; }
    .note {
      font-size: 12px;
      color: #666;
      margin-top: 8px;
      max-width: 900px;
    }
    .hidden {
      display: none;
    }
    a {
      color: #0b66c3;
    }
    .cup-count {
      font-weight: 600;
      margin: 0.5rem 0 1rem;
    }
    small {
      color: #555;
    }
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      padding: 12px;
      background: #ffffff;
      border-radius: 8px;
      margin: 16px 0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .filters label {
      font-size: 14px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .filters select,
    .filters input {
      padding: 4px 6px;
      font-size: 14px;
    }
    .table-scroll {
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #ffffff;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 8px 10px;
      border-bottom: 1px solid #eee;
      font-size: 13px;
      vertical-align: top;
    }
    th {
      background: #fafafa;
      position: sticky;
      top: 0px;
      z-index: 102;
    }
    th.sortable {
      cursor: pointer;
      user-select: none;
    }
    th.sortable::after {
      content: " â‡…";
      font-size: 11px;
      color: #888;
    }
    th.sorted-asc::after {
      content: " â†‘";
      font-size: 11px;
      color: #000;
    }
    th.sorted-desc::after {
      content: " â†“";
      font-size: 11px;
      color: #000;
    }
    tr:nth-child(even) td {
      background: #fcfcfc;
    }
    .level-tag {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      background: #eef;
    }
    .level-elite { background: #ffe5e5; }
    .level-bredd { background: #e5ffe8; }
    .level-mix   { background: #fff7e0; }
    .note {
      font-size: 12px;
      color: #666;
      margin-top: 8px;
      max-width: 900px;
    }
    .hidden {
      display: none;
    }
    a {
      color: #0b66c3;
    }
    .cup-count {
      font-weight: 600;
      margin: 0.5rem 0 1rem;
    }
  </style>
</head>
<body>
  <h1>Fotbollscuper 2026 â€“ P11:2</h1>
  <div class="filters">
    <label>MÃ¥nad
      <select id="monthSelect">
        <option value="">Alla</option>
        <option value="1">Januari</option>
        <option value="2">Februari</option>
        <option value="3">Mars</option>
        <option value="4">April</option>
        <option value="5">Maj</option>
        <option value="6">Juni</option>
        <option value="7">Juli</option>
        <option value="8">Augusti</option>
        <option value="9">September</option>
        <option value="10">Oktober</option>
        <option value="11">November</option>
        <option value="12">December</option>
      </select>
    </label>
    <label>Land
      <select id="countrySelect">
        <option value="">Alla</option>
        <option value="Sverige">Sverige</option>
        <option value="Norge">Norge</option>
        <option value="Finland">Finland</option>
        <option value="Danmark">Danmark</option>
        <option value="Spanien">Spanien</option>
        <option value="Frankrike">Frankrike</option>
        <option value="NederlÃ¤nderna">NederlÃ¤nderna</option>
        <option value="Lettland">Lettland</option>
        <option value="Belgien">Belgien</option>
        <option value="Italien">Italien</option>
        <option value="Portugal">Portugal</option>
      </select>
    </label>
    <label>NivÃ¥
      <select id="levelSelect">
        <option value="">Alla</option>
        <option value="elite">Elite</option>
        <option value="bredd">Bredd</option>
        <option value="mix">Mix</option>
      </select>
    </label>
    <label>Max spelarkostnad (â‚¬)
      <input type="number" id="maxCostInput" min="0" />
    </label>
    <label>SÃ¶k
      <input type="text" id="searchInput" placeholder="Cup, stad, land..." />
    </label>
    <label>Antal spelare
      <input type="number" id="numPlayers" min="0" value="15" />
    </label>
    <label>Antal ledare
      <input type="number" id="numCoaches" min="0" value="3" />
    </label>
  </div>
  <div class="cup-count" id="cupCounter"></div>
  <div id="totalCostDisplay"></div>
  <div class="table-scroll">
    <table>
      <thead>
        <tr>
          <th></th>
          <th data-sort-key="name" class="sortable">Cup</th>
          <th data-sort-key="startDate" class="sortable">Datum</th>
          <th data-sort-key="country" class="sortable">Land</th>
          <th data-sort-key="city" class="sortable">Stad</th>
          <th data-sort-key="level" class="sortable">NivÃ¥</th>
          <th data-sort-key="registrationDeadline" class="sortable">Sista anmÃ¤lan</th>
          <th data-sort-key="playerCostEurApprox" class="sortable">Spelare (â‚¬)</th>
          <th data-sort-key="leaderCostEurApprox" class="sortable">Ledare (â‚¬)</th>
          <th data-sort-key="teamFeeEurApprox" class="sortable">Lagavgift (â‚¬)</th>
          <th data-sort-key="accommodation" class="sortable">Boende</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
  <p class="note">
    * Sista anmÃ¤lningsdatum och kostnader Ã¤ndras ofta Ã¥r till Ã¥r och var inte
    alltid publicerade fÃ¶r 2026 nÃ¤r denna fil skapades. AnvÃ¤nd tabellen som
    utgÃ¥ngspunkt och dubbelkolla alltid pÃ¥ cupens officiella webbsida eller hos
    din researrangÃ¶r innan ni bestÃ¤mmer er eller gÃ¶r budget.
  </p>
  <script>
        function updateTotalCostDisplay() {
          const checkboxes = document.querySelectorAll('.cup-select');
          const selectedIndexes = Array.from(checkboxes)
            .filter(cb => cb.checked)
            .map(cb => parseInt(cb.getAttribute('data-index'), 10));
          const selectedCups = selectedIndexes.map(idx => currentCups[idx]).filter(Boolean);
          const numPlayers = parseInt(document.getElementById('numPlayers').value, 10) || 0;
          const numCoaches = parseInt(document.getElementById('numCoaches').value, 10) || 0;
          let total = 0;
          selectedCups.forEach(cup => {
            const playerCost = typeof cup.playerCostEurApprox === 'number' ? cup.playerCostEurApprox : 0;
            const coachCost = typeof cup.leaderCostEurApprox === 'number' ? cup.leaderCostEurApprox : 0;
            const teamFee = typeof cup.teamFeeEurApprox === 'number' ? cup.teamFeeEurApprox : 0;
            total += teamFee + (numPlayers * playerCost) + (numCoaches * coachCost);
          });
          const display = document.getElementById('totalCostDisplay');
          display.textContent = `Total kostnad: â‚¬${total}`;
        }
    // Globala variabler och DOM-element
    let cups = [];
    let currentCups = [];
    const monthSelect = document.getElementById('monthSelect');
    const countrySelect = document.getElementById('countrySelect');
    const levelSelect = document.getElementById('levelSelect');
    const maxCostInput = document.getElementById('maxCostInput');
    const searchInput = document.getElementById('searchInput');
    const headerCells = Array.from(document.querySelectorAll('th.sortable'));
    const tableBody = document.getElementById('tableBody');

    let currentSort = {
      key: "startDate",
      direction: "asc", // eller "desc"
    };

    function updateCupCount(count) {
      const el = document.getElementById("cupCounter");
      if (el) {
        el.textContent = `Antal cuper: ${count}`;
      }
    }

    function normalize(str) {
      return (str || "").toLowerCase().trim();
    }

    function parseDate(value) {
      if (!value) return null;
      const d = new Date(value);
      return isNaN(d.getTime()) ? null : d;
    }

    function applyFilters(cupsArray) {
      const month = monthSelect.value;
      const country = countrySelect.value;
      const level = levelSelect.value;
      const maxCost = maxCostInput.value ? parseFloat(maxCostInput.value) : null;
      const search = normalize(searchInput.value);

      return cupsArray.filter(cup => {
        if (month && String(cup.month) !== month) return false;
        if (country && cup.country !== country) return false;
        if (level && cup.level !== level) return false;

        if (maxCost !== null) {
          const cost = typeof cup.playerCostEurApprox === "number" ? cup.playerCostEurApprox : null;
          if (cost === null || cost > maxCost) return false;
        }

        if (search) {
          const text = normalize(
            `${cup.name} ${cup.city || ""} ${cup.country || ""} ${cup.dateText || ""}`
          );
          if (!text.includes(search)) return false;
        }

        return true;
      });

      currentCups = filtered;
      renderTable(currentCups); // updateCupCounter kÃ¶rs i renderCups
    }

    function compareValues(a, b, key) {
      const va = a[key];
      const vb = b[key];

      // datum
      if (key === "startDate" || key === "registrationDeadline") {
        const da = parseDate(va);
        const db = parseDate(vb);
        if (!da && !db) return 0;
        if (!da) return 1;
        if (!db) return -1;
        return da - db;
      }

      // tal
      if (typeof va === "number" || typeof vb === "number") {
        const na = typeof va === "number" ? va : Infinity;
        const nb = typeof vb === "number" ? vb : Infinity;
        if (na === nb) return 0;
        return na < nb ? -1 : 1;
      }

      // strÃ¤ng
      const sa = normalize(String(va || ""));
      const sb = normalize(String(vb || ""));
      if (sa === sb) return 0;
      return sa < sb ? -1 : 1;
    }

    function sortCups(cupsArray) {
      const sorted = [...cupsArray].sort((a, b) => {
        const cmp = compareValues(a, b, currentSort.key);
        return currentSort.direction === "asc" ? cmp : -cmp;
      });
      return sorted;
    }

    function levelClass(level) {
      if (level === "elite") return "level-elite";
      if (level === "bredd") return "level-bredd";
      if (level === "mix") return "level-mix";
      return "";
    }

    function renderTable() {
      const filtered = applyFilters(cups);
      const sorted = sortCups(filtered);
      currentCups = sorted;

      tableBody.innerHTML = "";

      sorted.forEach((cup, idx) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><input type="checkbox" class="cup-select" data-index="${idx}" /></td>
          <td>
            <strong>${cup.name}</strong><br />
            ${
              cup.url
                ? `<a href="${cup.url}" target="_blank">LÃ¤nk</a>`
                : ""
            }
          </td>
          <td>${cup.dateText || ""}</td>
          <td>${getCountryFlag(cup.country)} ${cup.country || ""}</td>
          <td>${cup.city || ""}</td>
          <td>
            ${
              cup.level
                ? `<span class=\"level-tag ${levelClass(cup.level)}\">${cup.levelDisplay || ""}</span>`
                : ""
            }
          </td>
          <td>${cup.registrationDeadlineText || ""}</td>
          <td>${cup.playerCostText || ""}</td>
          <td>${cup.leaderCostText || ""}</td>
          <td>${cup.teamFeeText || ""}</td>
          <td>${cup.accommodation || ""}</td>
        `;
        tableBody.appendChild(tr);
      });
      updateCupCount(sorted.length);
      // Add event listeners for checkboxes
      setTimeout(() => {
        document.querySelectorAll('.cup-select').forEach(cb => {
          cb.addEventListener('change', updateTotalCostDisplay);
        });
        updateTotalCostDisplay();
      }, 0);
      // Update the counter to show the filtered count
      updateCupCount(sorted.length);
      // update counter to show filtered count
      updateCupCount(sorted.length);
    }

    function setHeaderSortStyles() {
      headerCells.forEach(th => {
        th.classList.remove("sorted-asc", "sorted-desc");
        const key = th.getAttribute("data-sort-key");
        if (key === currentSort.key) {
          th.classList.add(currentSort.direction === "asc" ? "sorted-asc" : "sorted-desc");
        }
      });
    }

    function initSorting() {
      headerCells.forEach(th => {
        th.addEventListener("click", () => {
          const key = th.getAttribute("data-sort-key");
          if (!key) return;

          if (currentSort.key === key) {
            currentSort.direction = currentSort.direction === "asc" ? "desc" : "asc";
          } else {
            currentSort.key = key;
            currentSort.direction = "asc";
          }

          setHeaderSortStyles();
          renderTable();
        });
      });
      setHeaderSortStyles();
    }

    function initFilters() {
      [monthSelect, countrySelect, levelSelect, maxCostInput, searchInput].forEach(el => {
        el.addEventListener("input", () => {
          renderTable();
          updateTotalCostDisplay();
        });
        el.addEventListener("change", () => {
          renderTable();
          updateTotalCostDisplay();
        });
      });
      document.getElementById('numPlayers').addEventListener('input', updateTotalCostDisplay);
      document.getElementById('numCoaches').addEventListener('input', updateTotalCostDisplay);
    }

    async function loadData() {
      try {
        const response = await fetch("cuper_2026_data.json");
        cups = await response.json();
        updateCupCount(cups.length); // Show total on load
        renderTable();
      } catch (err) {
        console.error("Kunde inte ladda JSON-data:", err);
        tableBody.innerHTML = `
          <tr>
            <td colspan="10" style="color:red;">
              Kunde inte ladda cuper frÃ¥n <code>cuper_2026_data_cleaned.json</code>. Kontrollera filnamn och sÃ¶kvÃ¤g.
            </td>
          </tr>
        `;
      }
    }

    // Helper to get country flag emoji or image
    function getCountryFlag(country) {
      if (!country) return "";
      const flags = {
        "Sverige": "ðŸ‡¸ðŸ‡ª",
        "Norge": "ðŸ‡³ðŸ‡´",
        "Finland": "ðŸ‡«ðŸ‡®",
        "Danmark": "ðŸ‡©ðŸ‡°",
        "Spanien": "ðŸ‡ªðŸ‡¸",
        "Frankrike": "ðŸ‡«ðŸ‡·",
        "NederlÃ¤nderna": "ðŸ‡³ðŸ‡±",
        "Lettland": "ðŸ‡±ðŸ‡»",
        "Belgien": "ðŸ‡§ðŸ‡ª",
        "Italien": "ðŸ‡®ðŸ‡¹",
        "Portugal": "ðŸ‡µðŸ‡¹"
      };
      return flags[country] || "";
    }

    initSorting();
    initFilters();
    loadData();
  </script>
</body>
</html>
